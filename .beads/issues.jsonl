{"id":"invoice-hub-6gb","title":"Update timesheet creation with blob storage and duplicate handling","description":"Integrate blob storage into timesheet creation and add duplicate confirmation flow.\n\nTasks:\n- Update POST /api/timesheets to upload PDF to blob storage\n- Store blob URL in pdfUrl field instead of local path\n- Generate/refresh client's portal JWT on successful timesheet creation\n- Add duplicate check endpoint GET /api/timesheets/check?clientId=X\u0026month=Y\n- Add force parameter to POST /api/timesheets to replace existing\n- Update CreateTimesheetForm to check for existing and show confirmation dialog\n- Update existing tests, add tests for new behavior\n\nRef: openspec/changes/add-timesheet-persistence/tasks.md section 3","status":"closed","priority":2,"issue_type":"task","owner":"iam@tmcvee.com","created_at":"2026-01-20T21:53:45.110376+10:00","created_by":"Tim McVinish","updated_at":"2026-01-24T14:37:48.508631+10:00","closed_at":"2026-01-24T14:37:48.508631+10:00","close_reason":"Implemented blob storage upload, JWT generation, duplicate check endpoint, force parameter, and UI confirmation dialog. All 147 tests pass.","dependencies":[{"issue_id":"invoice-hub-6gb","depends_on_id":"invoice-hub-wob","type":"blocks","created_at":"2026-01-20T21:54:24.370634+10:00","created_by":"Tim McVinish"},{"issue_id":"invoice-hub-6gb","depends_on_id":"invoice-hub-y2f","type":"blocks","created_at":"2026-01-20T21:54:24.933356+10:00","created_by":"Tim McVinish"}]}
{"id":"invoice-hub-aqu","title":"Implement client portal timesheet viewing and approval","description":"Build the client-facing portal for viewing and approving timesheets.\n\nTasks:\n- Create GET /api/portal/[token] with JWT validation, return client data and timesheets\n- Create POST /api/portal/[token]/timesheets/[id]/approve endpoint\n- Update src/app/portal/[token]/page.tsx with timesheet list UI\n- Add approval button for pending timesheets\n- Show approved timesheets in History section\n- Add PDF download links\n- Create expired token page with contact admin message\n- Write tests for portal API routes (valid token, expired token, invalid token)\n\nRef: openspec/changes/add-timesheet-persistence/tasks.md section 5","status":"open","priority":2,"issue_type":"task","owner":"iam@tmcvee.com","created_at":"2026-01-20T21:53:46.24335+10:00","created_by":"Tim McVinish","updated_at":"2026-01-20T21:53:46.24335+10:00","dependencies":[{"issue_id":"invoice-hub-aqu","depends_on_id":"invoice-hub-y2f","type":"blocks","created_at":"2026-01-20T21:54:26.026296+10:00","created_by":"Tim McVinish"},{"issue_id":"invoice-hub-aqu","depends_on_id":"invoice-hub-6gb","type":"blocks","created_at":"2026-01-20T21:54:26.609963+10:00","created_by":"Tim McVinish"}]}
{"id":"invoice-hub-dul","title":"Add admin portal link management UI","description":"Allow admin to view, copy, and regenerate client portal links.\n\nTasks:\n- Add portal link display to client detail view (or clients list)\n- Add Copy Portal Link button\n- Add Regenerate Portal Link button with confirmation\n- Create POST /api/clients/[id]/regenerate-token endpoint\n\nRef: openspec/changes/add-timesheet-persistence/tasks.md section 6","status":"closed","priority":2,"issue_type":"task","owner":"iam@tmcvee.com","created_at":"2026-01-20T21:53:46.886631+10:00","created_by":"Tim McVinish","updated_at":"2026-01-21T21:50:53.50512+10:00","closed_at":"2026-01-21T21:50:53.50512+10:00","close_reason":"Closed","dependencies":[{"issue_id":"invoice-hub-dul","depends_on_id":"invoice-hub-y2f","type":"blocks","created_at":"2026-01-20T21:54:27.205991+10:00","created_by":"Tim McVinish"}]}
{"id":"invoice-hub-e1r","title":"Create admin timesheets page","description":"Add dedicated page for viewing and managing all timesheets.\n\nTasks:\n- Create src/app/(admin)/timesheets/page.tsx with timesheet list\n- Add columns: Client, Month, Status, Total Hours, Created, Actions\n- Add status badge component (pending/sent/approved/rejected)\n- Add View PDF action (opens blob URL)\n- Add navigation link to sidebar\n- Create timesheets.queries.ts for React Query hooks\n\nRef: openspec/changes/add-timesheet-persistence/tasks.md section 4","status":"open","priority":2,"issue_type":"task","owner":"iam@tmcvee.com","created_at":"2026-01-20T21:53:45.674964+10:00","created_by":"Tim McVinish","updated_at":"2026-01-20T21:53:45.674964+10:00","dependencies":[{"issue_id":"invoice-hub-e1r","depends_on_id":"invoice-hub-6gb","type":"blocks","created_at":"2026-01-20T21:54:25.486683+10:00","created_by":"Tim McVinish"}]}
{"id":"invoice-hub-wob","title":"Add Azure Blob Storage integration for PDF persistence","description":"Add @azure/storage-blob dependency and create blob client utility.\n\nTasks:\n- Add @azure/storage-blob dependency\n- Create src/lib/blob/client.ts with upload/download/delete functions\n- Add blob storage environment variables (AZURE_STORAGE_ACCOUNT, AZURE_STORAGE_CONTAINER)\n- Write tests for blob client (mock Azure SDK)\n\nRef: openspec/changes/add-timesheet-persistence/tasks.md section 1","status":"closed","priority":2,"issue_type":"task","owner":"iam@tmcvee.com","created_at":"2026-01-20T21:53:43.861363+10:00","created_by":"Tim McVinish","updated_at":"2026-01-20T22:19:24.470701+10:00","closed_at":"2026-01-20T22:19:24.470701+10:00","close_reason":"Implemented and tested"}
{"id":"invoice-hub-y2f","title":"Add JWT-based portal token infrastructure","description":"Set up JWT signing/verification for client portal access tokens.\n\nTasks:\n- Add portalToken field to Client model (String, optional - stores JWT)\n- Add JWT_SECRET environment variable for signing\n- Create src/lib/auth/jwt.ts with sign/verify/decode functions\n- Create migration\n- Write tests for JWT utilities\n\nRef: openspec/changes/add-timesheet-persistence/tasks.md section 2","status":"closed","priority":2,"issue_type":"task","owner":"iam@tmcvee.com","created_at":"2026-01-20T21:53:44.534693+10:00","created_by":"Tim McVinish","updated_at":"2026-01-20T22:19:24.507498+10:00","closed_at":"2026-01-20T22:19:24.507498+10:00","close_reason":"Implemented and tested"}
